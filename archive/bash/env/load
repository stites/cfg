#!/usr/bin/env bash

# ========================= #
# Load "run-once" settings  #
# ========================= #

# File may not exist, so don't follow for shellcheck linting (SC1090).
# shellcheck source=/dev/null
[[ ! -f "$HOME/.bash/functions"  ]] || source "$HOME/.bash/functions"

# ========================================================= #
# PATH Exports                                              #
# ========================================================= #
#safe_source "~/.bash/python"
safe_path_add /bin
safe_path_add /sbin
safe_path_add /usr/bin
safe_path_add /usr/sbin
safe_path_add /usr/local/bin
safe_path_add /usr/local/sbin

# ========================================================= #
# setup environments                                        #
# ========================================================= #
safe_source "$HOME/.bash/colors"

# match on all symlinks in ~/.bash
#          | \          remove anything with colors, prompt or load in the file name
#          |  `--------.                       |        `-.        `-------.__                finally, execute safe_source
#          |            `--.                   |           `-.                `--.                            |          .-,--- but make sure to inject the file correctly
#          v               |                   |             |                   |                            |         /  |
#find ~/.bash -type l \( -iname "*" ! -iname "colors" ! -iname "prompt" ! -iname "load" \) -exec bash -c 'safe_source "$0"' {} \;
# FIXME: this doesn't alter the current shell
safe_source "$HOME/.bash/gpg"

BASHRC_DEBUG=0
# vvvv    we want to ignore SC2044 because we need to execute safe_source in the current shell (ie: i can't get the above line to work)
# shellcheck disable=SC2044
for SETTING in $(find ~/.bash -type l \( -iname "*" ! -iname "colors" ! -iname "prompt" ! -iname "functions" ! -iname "load" ! -iname ".empty" ! -iname "gpg"  \)); do
  # # For debugging and performance checks, use these:
  if [ $BASHRC_DEBUG -ne 0 ]; then
    echo "$SETTING"
    time safe_source "$SETTING"
  else
    safe_source "$SETTING"
  fi
done

#safe_source "~/.bash/prompt_variables"   # will be covered in the above for-loop.
safe_source "$HOME/.bash/nix"                # to override pyenv
safe_source "$HOME/.bash/prompt"             # must be last

